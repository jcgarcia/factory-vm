# Security Best Practices

## ⚠️ IMPORTANT: Never Commit Secrets to Git

### What Happened

**Date**: November 21, 2025  
**Issue**: Exposed Jenkins API tokens and passwords in documentation  
**Files Affected**: 
- `docs/DONE.md` - Contained real API token in example
- `docs/CHANGELOG.md` - Contained hardcoded password

**Detection**: GitGuardian secret scanning  
**Severity**: Low (private repository, but still a security issue)

### What Was Exposed

1. **Jenkins API Token**: `11818b124bee61ba85e7685f596fc0dd12` (example in docs)
2. **Password**: `foreman123` (hardcoded in multiple documentation files)

### Remediation Actions Taken

✅ **Immediate Actions**:
1. Removed real API token from `DONE.md` - replaced with `YOUR_API_TOKEN_HERE`
2. Removed hardcoded password from `CHANGELOG.md` - replaced with "auto-generated"
3. Committed security fix: commit `c8c76f5`
4. Created this security note for future reference

✅ **Tokens/Passwords Status**:
- API tokens are auto-generated per installation (not a global secret)
- Each Factory VM installation generates its own unique tokens
- Exposed token was from development environment (no production impact)
- Password `foreman123` was example only (actual installations use random passwords)

## Security Best Practices Going Forward

### 1. Never Hardcode Credentials

❌ **NEVER DO THIS**:
```markdown
Password: foreman123
API Token: 11818b124bee61ba85e7685f596fc0dd12
```

✅ **ALWAYS DO THIS**:
```markdown
Password: Auto-generated (see ~/.factory-vm/credentials.txt)
API Token: Auto-generated (cached in ~/.jenkins-factory-token)
```

### 2. Use Placeholders in Examples

❌ **NEVER DO THIS**:
```bash
jenkins-factory -auth foreman:11818b124bee61ba85e7685f596fc0dd12
```

✅ **ALWAYS DO THIS**:
```bash
jenkins-factory -auth foreman:YOUR_API_TOKEN_HERE
jenkins-factory -auth foreman:$(cat ~/.jenkins-factory-token)
```

### 3. Reference Credential Storage Locations

Instead of showing actual credentials, document WHERE they are stored:

```markdown
**Credentials Location**: `~/.factory-vm/credentials.txt`
**Token Cache**: `~/.jenkins-factory-token`
**In Jenkins**: `/var/jenkins_home/foreman-api-token.txt`
```

### 4. Git Best Practices

Before committing:
```bash
# Check for potential secrets
git diff | grep -i "password\|token\|secret\|key"

# Use git-secrets (if installed)
git secrets --scan

# Review GitGuardian alerts in repository settings
```

### 5. Documentation Guidelines

When writing documentation:
- Use generic usernames: `user`, `admin`, `foreman`
- Use placeholder passwords: `YOUR_PASSWORD_HERE`, `<auto-generated>`
- Use placeholder tokens: `YOUR_TOKEN_HERE`, `<cached-token>`
- Always reference where real credentials can be found
- Never paste actual credentials, even in examples

## What Makes a Secret Dangerous?

### Low Risk (What We Had)
- ✅ Development environment only
- ✅ Auto-generated per installation
- ✅ Private repository
- ✅ No production systems affected
- ✅ Easily rotatable

### High Risk (What to Avoid)
- ❌ Production credentials
- ❌ Shared across systems
- ❌ Public repository
- ❌ Long-lived tokens
- ❌ Cloud provider API keys
- ❌ Database passwords
- ❌ SSH private keys

## Automated Detection

Our repositories have:
- ✅ GitGuardian scanning (detected these issues)
- ✅ Email alerts on secret detection
- ✅ Private repository (limits exposure)

## Response Checklist

If secrets are detected in the future:

1. **Assess Impact**
   - [ ] Is this a production secret?
   - [ ] Is the repository public?
   - [ ] How many systems are affected?

2. **Immediate Actions**
   - [ ] Rotate/invalidate the exposed secret
   - [ ] Remove from documentation
   - [ ] Commit the fix
   - [ ] Document the incident

3. **Verification**
   - [ ] Confirm secret is no longer in repository
   - [ ] Verify systems using the secret are updated
   - [ ] Check for other occurrences

4. **Prevention**
   - [ ] Update documentation guidelines
   - [ ] Review commit process
   - [ ] Consider using git-secrets hooks

## Lessons Learned

1. **Even examples can expose secrets** - Use placeholders always
2. **GitGuardian is valuable** - Catches mistakes before they become problems
3. **Private repos aren't immune** - Best practices apply everywhere
4. **Documentation review** - Check for hardcoded credentials before committing
5. **AI assistance** - Even AI can accidentally include real secrets in examples

## Tools to Prevent This

### Git-Secrets (Optional)
```bash
# Install git-secrets
brew install git-secrets  # macOS
# or
apt install git-secrets   # Ubuntu

# Initialize in repository
git secrets --install
git secrets --register-aws

# Scan repository
git secrets --scan-history
```

### Pre-commit Hooks
```bash
# .git/hooks/pre-commit
#!/bin/bash
if git diff --cached | grep -i "password.*:.*[a-zA-Z0-9]\{8,\}"; then
    echo "ERROR: Possible password detected in commit"
    echo "Please use placeholders like YOUR_PASSWORD_HERE"
    exit 1
fi
```

## Summary

✅ **Incident Contained**: No production impact, fixed immediately  
✅ **Prevention Added**: Documentation and guidelines updated  
✅ **Lessons Applied**: Will use placeholders in all future docs  

**Remember**: It's better to over-protect credentials than to under-protect them.

---

**Created**: November 21, 2025  
**Updated**: November 21, 2025  
**Status**: Resolved, guidelines in place
